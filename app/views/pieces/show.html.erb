<div class="chessboard">
  <% @board.reverse.each_with_index do |row, index_row| %>
    <%index_row = @board.length - index_row - 1 %>
      <div class = "row offset-3">
        <% row.each_with_index do |field, index_field| %>
          <span class="chess_field <%=field[:class]%>" row="<%=index_row%>" column= "<%=index_field%>">
            <%if index_field == @piece.column_coordinate && index_row == @piece.row_coordinate %>
              <span><%= image_tag @piece.image, class: 'chess_piece_selected'%></span>
            <%else%>
              <span><%= image_tag field[:piece].image unless field[:piece].nil?%></span>
            <%end%>
          </span>
        <%end%>
      </div>
  <%end%>
</div>

<script>
  $(function() {
    let url = window.location.href;
    let pieceId = url.substring(url.lastIndexOf('/') + 1);
    $(".chess_field").click(function(event){
      let row = ($(event.target).attr('row'));
      let column = ($(event.target).attr('column'));
      $("[row=" + "'" + row + "'" + "][column=" + "'" + column + "'" + "]").css("color","yellow");
      $.post("/pieces/" + pieceId, {
        _method: "PUT",
        piece: {
        row_coordinate: row,
        column_coordinate: column
        }
      });
    });
  });
</script>
